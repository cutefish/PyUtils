<execution name="cluster">
    <!-- This execution launches a group of containers and then check if they
         have the correct hostname-ip mapping and environment variables. -->

    <!-- The directory contains scripts to run in the container.-->
    <property name="script.path" value="example/scripts"/>

    <!-- The proxy of containers.-->
    <proxy http="www-proxy.us.oracle.com:80"/>

    <!-- A docker image.-->
    <image name="server-image">
        <install packages="python2.7, host"/>
        <startup scripts="ipconfig.py, host_status.sh" paths="${script.path}"/>
    </image>

    <!-- A group of containers from server-image with ids [1, 2, 3].-->
    <containers name="servers" image="server-image" ids="range(1, 4)">
        <container name="sna${id}"/>
        <env name="dkmngr_cluster_id" value="${id}"/>
    </containers>

    <!-- Execute a list of commands on containers in servers group with ids
         [1, 3]. Expect the result of IPs to be "*.*.*.1", "*.*.*.2", ...-->
    <exec name="check_status" containers="servers">
        <run cmd="host dns-server"/>
        <run cmd="host sna1"/>
        <run cmd="host sna2"/>
        <run cmd="host sna3"/>
        <run cmd="env"/>
        <expect value="[0-9]+\.[0-9]+\.[0-9]+\.1"/>
        <expect value="[0-9]+\.[0-9]+\.[0-9]+\.2"/>
        <expect value="[0-9]+\.[0-9]+\.[0-9]+\.3"/>
        <expect value="[0-9]+\.[0-9]+\.[0-9]+\.4"/>
        <expect value="dkmngr_cluster_id=${id}"/>
    </exec>
</execution>
